<!DOCTYPE html>
  <html>
    <head>
      <title>Login - MHS March Madness</title>
        <!-- Gets the firebase server script -->
      <script src='https://cdn.firebase.com/js/client/2.2.1/firebase.js'></script>
       <!--Gets the Jquery source--->
      <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
       <!--Links this html file to its css file-->
      <link rel="stylesheet" type="text/css" href="css/madness.css"/>
    </head>
    
    <body>
      <!--Organizes the page via div classes for the css and js files-->
      <div class="page">
          <div class="heading">
              <h2>Mustang Madness</h2>
          </div>
          <!-- Unecessary section for current match -->
          <!-- TODO: Move to welcome/home page for app -->
          <!-- end unecessary section -->
          
          <!-- begin login form's  html -->
          <div class="input_box" id="login_form">
            <h3>Login</h3>
            <fieldset>
              <legend>Login</legend>
              <form>
      					 <label>Student ID:</label>
      					 <br>
      			     <input id="student_id" type="number" onkeydown="if (event.keyCode == 13) document.getElementById('btn_login').click()" placeholder="140123">
      					 <br>
      					 <label>Password:</label>
      					 <br>
      					 <input id="login_password" type="password"  onkeydown="if (event.keyCode == 13) document.getElementById('btn_login').click()" placeholder="Your Password">
      					 <br>
      				   <label>Username: </label>
      					 <br>
      					 <input id="username" type="text" onkeydown="if (event.keyCode == 13) document.getElementById('btn_login').click()" onclick=""  placeholder="Ex: MLG rockwrecker"></input>
      					 <br>
      			     <button id="btn_login" type="button" onclick="buttonLogin()">Submit</button>
      				</form>
    				</fieldset>
  				</div>
  				
  				<!-- begin signup form's  html -->
          <div class="input_box" id="signup_form">
            <h3>Signup</h3>
            <fieldset>
              <legend>Create Account</legend>
              <form id="email_form">
                <label>Student Email:</label>
                <br>
                <input id="email" type="email" onkeydown="if (event.keyCode == 13) document.getElementById('btn_email').click()" placeholder="140123@students.d120.org">
      					<br>
      					<button id="btn_email" type="button" onkeydown="if (event.keyCode == 13) document.getElementById('btn_email').click()">Submit</button>
      				</form>
    				</fieldset>
  				</div>
      </div>
      <script src="http://crypto-js.googlecode.com/svn/tags/3.1.2/build/rollups/md5.js"></script>
      <script>
        var loginBase = new Firebase("https://loginbase.firebaseio-loginbase.com");
        var auth = new FirebaseAuthClient(loginBase, function(error, user) {
              if (error) {
                alert(error);
                return;
              }
              if (user) {
                login_user(user);
              } else {
                create_user();
              }
        });
  
        var email_button = $('#btn_email');
        var login_button = $('#btn_login');
        var email, school_id, password;
        var nickname;
        
        function create_user(){
          email_button.click(function(){
            email = document.getElementById('email').value;
            school_id = email.substring(3, 9);
            
            var hash = CryptoJS.MD5(school_id).toString();
            var password_result = "";
            password_result = hash.substring(0, 6);
            
            loginBase.createUser(email, password_result, function(error,  user) {
              if (!error) {
                doLogin(user);
              } else {
                alert(error);
              }
            });
          });
          
          login_button.click(function(){
            var user = document.getElementById('student_id').value+'@students.d120.org';
            var login_pass = document.getElementById('login_password').value;
            auth.login({
              email: user,
              password: login_pass
            });
          });
        }
      </script>
      <!-- madness.js holds the code for the mustang madness -->
      <script type="text/javascript" src="js/madness.js"></script>
    </body>
  </html>
