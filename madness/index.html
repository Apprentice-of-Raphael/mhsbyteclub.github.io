<!DOCTYPE html>
  <html>
    <head>
      <title>Login - MHS March Madness</title>
        <!-- Gets the firebase server script -->
      <script src='https://cdn.firebase.com/js/client/2.2.1/firebase.js'></script>
      <!--added angularfire script-->
      <script src="https://cdn.firebase.com/libs/angularfire/0.9.1/angularfire.min.js"></script>
       <!--Gets the Jquery source-->
      <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
       <!--Links this html file to its css file-->
      <link rel="stylesheet" type="text/css" href="css/madness.css"/>
    </head>
    
    <body>
      <!--Organizes the page via div classes for the css and js files-->
      <div class="page">
          <div class="login_tag">
            <!--<h4 id="login_nametag">Logged Out</h4>-->
          </div>
          <div class="heading" id="click_mad">
              <h2>Mustang Madness</h2>
          </div>
          <!-- Unecessary section for current match -->
          <!-- TODO: Move to welcome/home page for app -->
          <!-- end unecessary section -->
          
          <!-- begin login form's  html -->
          <div class="input_box" id="login_form">
            <h3>Login</h3>
            <!--fieldset puts a box around the form -->
            <fieldset>
              <!--legend puts a legend on the fieldset box -->
              <legend>Login</legend>
              <form>
      					 <label>Student Email:</label>
      					 <br>
      			     <input id="student_id" type="email" onkeydown="if (event.keyCode == 13) document.getElementById('btn_login').click()" placeholder="150123@students.d120.org">
      					 <br>
      					 <label>Password:</label>
      					 <br>
      					 <input id="login_password" type="password"  onkeydown="if (event.keyCode == 13) document.getElementById('btn_login').click()" placeholder="Your Password">
      					 <br>
      			     <button id="btn_login" type="button" onclick="loginUser()">Submit</button>
      				</form>
    				</fieldset>
  				</div>
  				
  				<!-- begin signup form's  html -->
          <div class="input_box" id="signup_form">
            <h3>Signup</h3>
            <fieldset>
              <legend>Create Account</legend>
              <form id="email_form">
                <label>Student Email:</label>
                <br>
                <input id="email" type="email" onkeydown="if (event.keyCode == 13) document.getElementById('btn_email').click()" placeholder="140123@students.d120.org">
      					<br>
      					<button id="btn_email" type="button" onkeydown="if (event.keyCode == 13) document.getElementById('btn_email').click()" onclick="newUser()">Submit</button>
      				</form>
    				</fieldset>
  				</div>
  				
  				<div class="pass_by">
  				  <p id="pass_show"></p>
  				</div>
  				
  				<div class="easter_egg">
  				  <!--<img src="http://i.kinja-img.com/gawker-media/image/upload/s--_M4xTG4R--/c_fit,fl_progressive,q_80,w_636/bxoy1zbuqwfwmsqaw5wn.gif" width="400" height="400">-->
  				</div>
  				
  				<div class="meanwhile">
  				  <h4>Meanwhile at the tournament...</h4>
  				  <iframe src="http://www.mhsbyte.org/madness/home.html"></iframe>
  				</div>
  				
  				<canvas id="mad"></canvas>
      </div>
      <script>
      //Create new firebase
        var loginBase = new Firebase("https://marchmadness.firebaseio.com");
        //Used User login with Authentication
        var auth = loginbase.getAuth();
        //listen for changes in the authentication state
        loginBase.onAuth(authState);
  
        var school_email, school_id;
        var pass, id;
        var admin = [];
        
        function newUser(){
          setAdmin();
          //gets the value from the email box
          school_email = document.getElementById('email').value;
        
          password_result = "";
          
          loginBase.createUser({
            email: school_email,
            password: password_result
            //On error the first argument will be an error argument
            //If successful the first argument is null, and the second argument contains the info for the new User
          }, function(error, userData){
            if(error){
              switch(error.code){
               //Checks for an error and then specifies it 
                case "EMAIL_TAKEN":
                  alert("Email has already been taken.");
                  break;
                case "INVALID_EMAIL":
                  alert("The email given isn't a valid address");
                  break;
                default:
                  alert("There has been in error updating an account: "+error.code+". If the problem presists then email the site admin at: "+admin[Math.floor(Math.random(0, admin.length))]);
              } 
            }else{
              alert("Successfully signed up in.");
            }
          });
        }
        
        function loginUser(){
          setAdmin();
          
          id = document.getElementById("student_id").value;
          pass = document.getElementById("login_password").value;
                  
          loginBase.authWithPassword({
            email    : id,
            password : pass
            //error catching
          }, function(error, authData){
            if(error){
              alert("There has been an error logging you in: "+error.code+". If your problem persists email the site admin at: "+admin[Math.floor(Math.random(0, admin.length))]);
            }else{
              alert("Successful login.");
            }
          });
          location.href="http://mhsbyteclub.github.io/madness/home.html";
        }
        
        function setAdmin(){
          admin.push("170478@students.d120.org");
        }
        
        function authState(authData){
          if(authData){
            location.href="http://mhsbyteclub.github.io/madness/home.html";
          }else{
            //User isn't logged in
            return;
          }
        }
      </script>
      <!-- madness.js holds the code for the mustang madness -->
      <script type="text/javascript" src="js/madness.js"></script>
    </body>
  </html>
