<!DOCTYPE html>
  <html>
    <head>
      <title>Login - MHS March Madness</title>
        <!-- Gets the firebase server script -->
      <script src='https://cdn.firebase.com/js/client/2.2.1/firebase.js'></script>
       <!--Gets the Jquery source-->
      <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
       <!--Links this html file to its css file-->
      <link rel="stylesheet" type="text/css" href="css/madness.css"/>
    </head>
    
    <body>
      <!--Organizes the page via div classes for the css and js files-->
      <div class="page">
          <div class="heading">
              <h2>Mustang Madness</h2>
          </div>
          <!-- Unecessary section for current match -->
          <!-- TODO: Move to welcome/home page for app -->
          <!-- end unecessary section -->
          
          <!-- begin login form's  html -->
          <div class="input_box" id="login_form">
            <h3>Login</h3>
            <fieldset>
              <legend>Login</legend>
              <form>
      					 <label>Student ID:</label>
      					 <br>
      			     <input id="student_id" type="number" onkeydown="if (event.keyCode == 13) document.getElementById('btn_login').click()" placeholder="140123">
      					 <br>
      					 <label>Password:</label>
      					 <br>
      					 <input id="login_password" type="password"  onkeydown="if (event.keyCode == 13) document.getElementById('btn_login').click()" placeholder="Your Password">
      					 <br>
      				   <label>Username: </label>
      					 <br>
      					 <input id="username" type="text" onkeydown="if (event.keyCode == 13) document.getElementById('btn_login').click()" onclick=""  placeholder="Ex: MLG rockwrecker"></input>
      					 <br>
      			     <button id="btn_login" type="button" onclick="buttonLogin()">Submit</button>
      				</form>
    				</fieldset>
  				</div>
  				
  				<!-- begin signup form's  html -->
          <div class="input_box" id="signup_form">
            <h3>Signup</h3>
            <fieldset>
              <legend>Create Account</legend>
              <form id="email_form">
                <label>Student Email:</label>
                <br>
                <input id="email" type="email" onkeydown="if (event.keyCode == 13) document.getElementById('btn_email').click()" placeholder="140123@students.d120.org">
      					<br>
      					<button id="btn_email" type="button" onkeydown="if (event.keyCode == 13) document.getElementById('btn_email').click()">Submit</button>
      				</form>
    				</fieldset>
  				</div>
  				
  				<div class="result">
  				  <p id="pass_show"></p>
  				</div>
      </div>
      <script src="http://crypto-js.googlecode.com/svn/tags/3.1.2/build/rollups/md5.js"></script>
      <script>
      //Create new firebase
        var loginBase = new Firebase("https://loginbase.firebaseio-loginbase.com");
        //Used User login with Authentication
        var auth = loginbase.getAuth();
        //listen for changes in the authentication state
        loginBase.onAuth(authState);
        
        var email_button = $('#btn_email');
        var login_button = $('#btn_login');
        var school_email, school_id;
        var nickname, pass;
        
        email_button.click(function(){
          school_email = document.getElementById('email').value;
          school_id = school_email.substring(0, 6);
            
          var hash = CryptoJS.MD5(school_id).toString();
          var password_result = "";
          password_result = hash.substring(3, 9);

          document.getElementById('pass_show').innerHTML = "Your Password Is: "+password_result;
          
          loginBase.createUser({
            email: school_email,
            password: password_result
          }), function(error, userData){
            if(error){
              switch(error.code){
                case "EMAIL_TAKEN":
                  alert("Email has already been taken.");
                  break;
                case "INVALID_EMAIL":
                  alert("The email given isn't a valid address");
                  break;
                default:
                  alert("There has been in error updating an account");
              } 
            }else{
              alert("Successfully logged in.");
            }
          });
        });
        
        login_button.click(function(){
          id = document.getElementById("student_id").value;
          pass = document.getElementById("login_password").value;
          nickname = document.getElementById("username").value;
          
          loginBase.authWithPassword({
            email    : id+"@students.d120.org",
            password : pass
            //error catching
          }), function(error, authData){
            if(error){
              alert("There has been an error loggining you in.");
            }else{
              alert("Successful login.");
            }
          });
          loginBase.push(nickname);
        });
        
        function authState(authData){
          if(authData){
            //User is logged in
          }else{
            //User isn't logged in
          }
        }
      </script>
      <!-- madness.js holds the code for the mustang madness -->
      <script type="text/javascript" src="js/madness.js"></script>
    </body>
  </html>
